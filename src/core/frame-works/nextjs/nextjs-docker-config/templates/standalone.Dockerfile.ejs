# templates/nextjs/standalone.Dockerfile.ejs

FROM node:<%= nodeVersion %>-alpine
WORKDIR /app

ENV PORT=<%= port %>

COPY package*.json ./
# Install dependencies
RUN <%= installCommand %>

# Copy source and build the app
COPY . .
RUN <%= buildCommand %>

# Merge public and static into the standalone bundle folder
RUN mkdir -p <%= outputDirectory %>/<%= output %>/public \
    && mkdir -p <%= outputDirectory %>/<%= output %>/.next/static \
    && cp -R public/* <%= outputDirectory %>/<%= output %>/public/ \
    && cp -R .next/static/* <%= outputDirectory %>/<%= output %>/.next/static/

# Expose port and start
EXPOSE <%= port %>
WORKDIR /app/<%= outputDirectory %>/<%= output %>
CMD ["node", "server.js"]
