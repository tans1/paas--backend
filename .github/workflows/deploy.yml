name: Deploy

on:
  push:
    paths:
      - prisma/migrations/** 
    branches:
      - main 

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      
      - name: Checkout repo
        uses: actions/checkout@v3

     
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 
     
      - name: Install dependencies
        run: npm install

      
      - name: Apply all pending migrations to the database
        run: npx prisma migrate deploy
        env:
          DATABASE_URL: "postgresql://finalyearprojectdb_user:CR6nDelC9i6FlIidAoKLNFIUkR9SVXKw@dpg-ctt6up3v2p9s738g0v10-a/finalyearprojectdb"
